{% autoescape None %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tuxhub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href="{{ static_url('bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
    <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script src="{{ static_url('bootstrap/js/jquery.min.js') }}"></script>
    <script src="{{ static_url('js/jquery.timeago.js') }}"></script>
    <script src="{{ static_url('bootstrap/js/bootstrap.min.js') }}"></script>
  </head>

  <body>
    <div class="container-fluid">
      <div class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="/{{ current_user['user_name'] }}">Profile</a></li>
              <li><a href="/auth/logout">Logout</a></li>
            </ul>
            <ul class="nav pull-right">
              <li><a href="#">{{ current_user['name'] }}</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="row-fluid">

        <div class="span8 well">
          <form method="post" action="#" id="feed_form" onSubmit="return false;">
            {{ xsrf_form_html() }}
            <textarea id="feed" name="feed" class="input-xxlarge" placeholder="Karala Bakalım" rows="6"></textarea>
            <input type="hidden" id="time" name="time" value="">
            <input type="checkbox" name="twitter" value="true">Twitter
          </form>
          <button id="submit" class="btn" onclick="javascript:return false;">Yaz gitsin</button>
        </div>
        
        <div class="span3">
          <div class="row-fluid">
            <div class="span12" style="background-color:blue">sad</div>
          </div>
          <div class="row-fluid">
            <div class="span12" style="background-color:yellow">sad</div>
          </div>
        </div>

        <div class="span8" id="feeds">
            {% for i in feeds %}
                <div id="{{ i['_id'] }}" class="well">
                    <div class="user"><img width="50" height="50" src="/p/{{ i['profile'] }}"><b>{{ i['user'] }}: </b> (<span class="timeago">{{i['time']}}</span>)</div>
                    <div class="feed_content">&nbsp;&nbsp;{{ i['text'] }}</div>
                </div>
            {% end %}
        </div>
      </div>

<footer>Tuxhub 2012</footer>
    </div><!--fluid container-->

<script>
var ws = new WebSocket("ws://localhost:18888/update");
ws.onopen = function(){} // Soket açıldığında..
ws.onmessage = function(m){
    $("#feeds").html(m.data+$("#feeds").html());
    $(".timeago").each(function(){
        $(this).html($.timeago($(this).html()));
    });
}
$(document).ready(function(){

    $("#feed_form").submit(function(e){ e.preventDefault(); return false; });
    $("button#submit").click(function(e){
        e.preventDefault();
        $("#time").val(new Date().toISOString());
        $.post("/",$("#feed_form").serialize());
        data = {
            user_name: '{{ current_user["user_name"] }}',
            feed: $("#feed").val(),
            time: (new Date()).toISOString()
        }
        ws.send(JSON.stringify(data));
        return false;
    });
    $(".timeago").each(function(){
        $(this).html($.timeago($(this).html()));
    });

});
</script>
  </body>
</html>